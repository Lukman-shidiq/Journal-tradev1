<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Journal By Lukmanshidiq - Trading Journal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Playfair Display', 'serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        gold: {
                            400: '#fbbf24',
                            500: '#f59e0b',
                            600: '#d97706',
                        },
                        dark: {
                            900: '#0f172a',
                            800: '#1e293b',
                            700: '#334155',
                        }
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 6s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .glass-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        .dark .glass-card {
            background: linear-gradient(135deg, rgba(30,41,59,0.8) 0%, rgba(15,23,42,0.9) 100%);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        .gold-gradient-text {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #d97706 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .gold-gradient-bg {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #d97706 100%);
        }
        .neon-glow {
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.3), 0 0 40px rgba(245, 158, 11, 0.1);
        }
        .card-hover {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .card-hover:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px -12px rgba(245, 158, 11, 0.25);
        }
        .slide-in {
            animation: slideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #f59e0b 0%, #d97706 100%);
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #fbbf24 0%, #f59e0b 100%);
        }
        .signature-font {
            font-family: 'Playfair Display', serif;
        }
        .mono-font {
            font-family: 'JetBrains Mono', monospace;
        }
        .status-badge {
            position: relative;
            overflow: hidden;
        }
        .status-badge::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shimmer 2s infinite;
        }
        @keyframes shimmer {
            100% { left: 100%; }
        }
        .grid-pattern {
            background-image: radial-gradient(circle at 1px 1px, rgba(245,158,11,0.15) 1px, transparent 0);
            background-size: 40px 40px;
        }
        .floating-icon {
            animation: float 6s ease-in-out infinite;
        }
        .profit-glow {
            text-shadow: 0 0 20px rgba(34, 197, 94, 0.5);
        }
        .loss-glow {
            text-shadow: 0 0 20px rgba(239, 68, 68, 0.5);
        }
    </style>
</head>
<body class="bg-slate-950 text-gray-100 min-h-screen grid-pattern">
    
    <!-- Ambient Background -->
    <div class="fixed inset-0 pointer-events-none overflow-hidden">
        <div class="absolute top-0 left-1/4 w-96 h-96 bg-amber-500/10 rounded-full blur-3xl animate-pulse-slow"></div>
        <div class="absolute bottom-0 right-1/4 w-96 h-96 bg-orange-500/10 rounded-full blur-3xl animate-pulse-slow" style="animation-delay: 1.5s;"></div>
    </div>

    <!-- Navigation -->
    <nav class="fixed w-full z-50 glass border-b border-white/10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20 items-center">
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <div class="w-12 h-12 gold-gradient-bg rounded-2xl flex items-center justify-center text-white font-bold text-xl shadow-lg neon-glow floating-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-slate-950 animate-pulse"></div>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-2xl font-bold signature-font gold-gradient-text tracking-wide">Lukmanshidiq</span>
                        <span class="text-xs text-gray-400 tracking-[0.2em] uppercase font-medium">Trading Journal</span>
                    </div>
                </div>
                
                <div class="hidden md:flex items-center space-x-8">
                    <a href="#dashboard" class="group relative text-gray-300 hover:text-amber-400 transition-colors font-medium">
                        Dashboard
                        <span class="absolute -bottom-1 left-0 w-0 h-0.5 gold-gradient-bg group-hover:w-full transition-all duration-300"></span>
                    </a>
                    <a href="#journal" class="group relative text-gray-300 hover:text-amber-400 transition-colors font-medium">
                        Journal
                        <span class="absolute -bottom-1 left-0 w-0 h-0.5 gold-gradient-bg group-hover:w-full transition-all duration-300"></span>
                    </a>
                    <button onclick="toggleTheme()" class="p-3 rounded-xl bg-white/5 hover:bg-white/10 border border-white/10 transition-all hover:scale-110">
                        <i class="fas fa-moon text-gray-400 hover:text-amber-400 transition-colors"></i>
                    </button>
                </div>
                
                <button onclick="openModal()" class="group relative px-6 py-3 gold-gradient-bg text-white rounded-xl font-semibold transition-all transform hover:scale-105 neon-glow overflow-hidden">
                    <span class="relative z-10 flex items-center gap-2">
                        <i class="fas fa-plus"></i>
                        <span>New Trade</span>
                    </span>
                    <div class="absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="relative pt-28 pb-12 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto">
        
        <!-- Dashboard Stats -->
        <section id="dashboard" class="mb-12 slide-in">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Total P&L Card -->
                <div class="glass-card rounded-2xl p-6 card-hover relative overflow-hidden group">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-amber-500/10 rounded-full blur-2xl group-hover:bg-amber-500/20 transition-all"></div>
                    <div class="flex justify-between items-start relative z-10">
                        <div>
                            <p class="text-sm text-gray-400 font-medium tracking-wider uppercase mb-1">Total P&L</p>
                            <h3 class="text-4xl font-bold mono-font tracking-tight" id="totalPnL">$0.00</h3>
                        </div>
                        <div class="p-3 bg-amber-500/20 rounded-xl text-amber-400 border border-amber-500/30">
                            <i class="fas fa-wallet text-xl"></i>
                        </div>
                    </div>
                    <div class="mt-6 flex items-center gap-3">
                        <span class="px-3 py-1 rounded-full bg-green-500/20 text-green-400 text-sm font-medium flex items-center gap-1 border border-green-500/30">
                            <i class="fas fa-arrow-up text-xs"></i>
                            <span id="winRate">0%</span>
                        </span>
                        <span class="text-gray-500 text-sm">Win Rate</span>
                    </div>
                </div>

                <!-- Active Trades Card -->
                <div class="glass-card rounded-2xl p-6 card-hover relative overflow-hidden group">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-blue-500/10 rounded-full blur-2xl group-hover:bg-blue-500/20 transition-all"></div>
                    <div class="flex justify-between items-start relative z-10">
                        <div>
                            <p class="text-sm text-gray-400 font-medium tracking-wider uppercase mb-1">Active Trades</p>
                            <h3 class="text-4xl font-bold mono-font tracking-tight text-blue-400" id="activeTrades">0</h3>
                        </div>
                        <div class="p-3 bg-blue-500/20 rounded-xl text-blue-400 border border-blue-500/30">
                            <i class="fas fa-clock text-xl"></i>
                        </div>
                    </div>
                    <div class="mt-6">
                        <div class="flex items-center gap-2 text-sm text-gray-400">
                            <span class="w-2 h-2 bg-blue-400 rounded-full animate-pulse"></span>
                            <span>Open positions</span>
                        </div>
                    </div>
                </div>

                <!-- Best Trade Card -->
                <div class="glass-card rounded-2xl p-6 card-hover relative overflow-hidden group">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-green-500/10 rounded-full blur-2xl group-hover:bg-green-500/20 transition-all"></div>
                    <div class="flex justify-between items-start relative z-10">
                        <div>
                            <p class="text-sm text-gray-400 font-medium tracking-wider uppercase mb-1">Best Trade</p>
                            <h3 class="text-4xl font-bold mono-font tracking-tight text-green-400 profit-glow" id="bestTrade">$0.00</h3>
                        </div>
                        <div class="p-3 bg-green-500/20 rounded-xl text-green-400 border border-green-500/30">
                            <i class="fas fa-trophy text-xl"></i>
                        </div>
                    </div>
                    <div class="mt-6">
                        <span class="text-gray-500 text-sm">Highest profit achieved</span>
                    </div>
                </div>

                <!-- Total Trades Card -->
                <div class="glass-card rounded-2xl p-6 card-hover relative overflow-hidden group">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-purple-500/10 rounded-full blur-2xl group-hover:bg-purple-500/20 transition-all"></div>
                    <div class="flex justify-between items-start relative z-10">
                        <div>
                            <p class="text-sm text-gray-400 font-medium tracking-wider uppercase mb-1">Total Trades</p>
                            <h3 class="text-4xl font-bold mono-font tracking-tight text-purple-400" id="totalTrades">0</h3>
                        </div>
                        <div class="p-3 bg-purple-500/20 rounded-xl text-purple-400 border border-purple-500/30">
                            <i class="fas fa-list-ol text-xl"></i>
                        </div>
                    </div>
                    <div class="mt-6 flex gap-4 text-sm">
                        <span class="text-green-400 font-medium mono-font"><span id="totalWins">0</span> W</span>
                        <span class="text-gray-600">|</span>
                        <span class="text-red-400 font-medium mono-font"><span id="totalLosses">0</span> L</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Quick Stats Row -->
        <section class="mb-12 slide-in">
            <div class="glass-card rounded-2xl p-2">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                    <div class="p-6 rounded-xl bg-gradient-to-br from-green-500/10 to-transparent border border-green-500/20 text-center group hover:border-green-500/40 transition-all">
                        <p class="text-4xl font-bold mono-font text-green-400 mb-2 group-hover:scale-110 transition-transform" id="winningStreak">0</p>
                        <p class="text-xs text-gray-400 uppercase tracking-wider">Winning Streak</p>
                    </div>
                    <div class="p-6 rounded-xl bg-gradient-to-br from-red-500/10 to-transparent border border-red-500/20 text-center group hover:border-red-500/40 transition-all">
                        <p class="text-4xl font-bold mono-font text-red-400 mb-2 group-hover:scale-110 transition-transform" id="losingStreak">0</p>
                        <p class="text-xs text-gray-400 uppercase tracking-wider">Losing Streak</p>
                    </div>
                    <div class="p-6 rounded-xl bg-gradient-to-br from-blue-500/10 to-transparent border border-blue-500/20 text-center group hover:border-blue-500/40 transition-all">
                        <p class="text-4xl font-bold mono-font text-blue-400 mb-2 group-hover:scale-110 transition-transform" id="avgWin">$0</p>
                        <p class="text-xs text-gray-400 uppercase tracking-wider">Average Win</p>
                    </div>
                    <div class="p-6 rounded-xl bg-gradient-to-br from-orange-500/10 to-transparent border border-orange-500/20 text-center group hover:border-orange-500/40 transition-all">
                        <p class="text-4xl font-bold mono-font text-orange-400 mb-2 group-hover:scale-110 transition-transform" id="avgLoss">$0</p>
                        <p class="text-xs text-gray-400 uppercase tracking-wider">Average Loss</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Trading Journal -->
        <section id="journal" class="slide-in">
            <div class="glass-card rounded-2xl overflow-hidden border border-white/10">
                <div class="p-6 border-b border-white/10 flex flex-col sm:flex-row justify-between items-center gap-4 bg-gradient-to-r from-amber-500/5 to-transparent">
                    <div class="flex items-center gap-4">
                        <div class="p-3 gold-gradient-bg rounded-xl shadow-lg">
                            <i class="fas fa-book-open text-white text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold signature-font gold-gradient-text">Trading Journal</h3>
                            <p class="text-xs text-gray-400 mt-1">Complete trade history & analytics</p>
                        </div>
                    </div>
                    <div class="flex gap-3">
                        <div class="relative group">
                            <input type="text" id="searchInput" placeholder="Search trades..." class="pl-10 pr-4 py-3 bg-slate-800/50 border border-white/10 rounded-xl focus:outline-none focus:border-amber-500/50 focus:bg-slate-800 w-64 transition-all text-sm">
                            <i class="fas fa-search absolute left-3 top-3.5 text-gray-500 group-focus-within:text-amber-400 transition-colors"></i>
                        </div>
                        <button onclick="exportToExcel()" class="px-4 py-3 bg-green-600 hover:bg-green-500 text-white rounded-xl transition-all hover:scale-105 flex items-center gap-2 border border-green-400/30 shadow-lg shadow-green-500/20">
                            <i class="fas fa-file-excel text-lg"></i>
                            <span class="hidden sm:inline font-medium">Export Excel</span>
                        </button>
                    </div>
                </div>
                
                <div class="overflow-x-auto custom-scrollbar">
                    <table class="w-full">
                        <thead class="bg-slate-800/50 text-left">
                            <tr>
                                <th class="px-6 py-4 text-xs font-semibold text-gray-400 uppercase tracking-wider cursor-pointer hover:text-amber-400 transition-colors group" onclick="sortTable('date')">
                                    Date <i class="fas fa-sort ml-1 opacity-50 group-hover:opacity-100"></i>
                                </th>
                                <th class="px-6 py-4 text-xs font-semibold text-gray-400 uppercase tracking-wider cursor-pointer hover:text-amber-400 transition-colors group" onclick="sortTable('asset')">
                                    Asset <i class="fas fa-sort ml-1 opacity-50 group-hover:opacity-100"></i>
                                </th>
                                <th class="px-6 py-4 text-xs font-semibold text-gray-400 uppercase tracking-wider">Type</th>
                                <th class="px-6 py-4 text-xs font-semibold text-gray-400 uppercase tracking-wider text-right">Entry</th>
                                <th class="px-6 py-4 text-xs font-semibold text-gray-400 uppercase tracking-wider text-right">Exit</th>
                                <th class="px-6 py-4 text-xs font-semibold text-gray-400 uppercase tracking-wider text-right">Size</th>
                                <th class="px-6 py-4 text-xs font-semibold text-gray-400 uppercase tracking-wider text-right cursor-pointer hover:text-amber-400 transition-colors group" onclick="sortTable('pnl')">
                                    P&L <i class="fas fa-sort ml-1 opacity-50 group-hover:opacity-100"></i>
                                </th>
                                <th class="px-6 py-4 text-xs font-semibold text-gray-400 uppercase tracking-wider text-center">Status</th>
                                <th class="px-6 py-4 text-xs font-semibold text-gray-400 uppercase tracking-wider text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="tradesTableBody" class="divide-y divide-white/5">
                            <!-- Dynamic content -->
                        </tbody>
                    </table>
                </div>
                
                <div class="p-4 border-t border-white/10 flex justify-between items-center bg-slate-800/30">
                    <p class="text-sm text-gray-400">Showing <span id="showingCount" class="text-amber-400 font-bold">0</span> trades</p>
                    <div class="flex gap-2">
                        <button onclick="changePage(-1)" class="px-4 py-2 bg-slate-800 hover:bg-slate-700 border border-white/10 rounded-lg transition-all hover:border-amber-500/30 text-sm flex items-center gap-2">
                            <i class="fas fa-chevron-left text-xs"></i> Prev
                        </button>
                        <span class="px-4 py-2 text-sm text-gray-400 flex items-center">
                            Page <span id="currentPage" class="text-amber-400 font-bold mx-1">1</span>
                        </span>
                        <button onclick="changePage(1)" class="px-4 py-2 bg-slate-800 hover:bg-slate-700 border border-white/10 rounded-lg transition-all hover:border-amber-500/30 text-sm flex items-center gap-2">
                            Next <i class="fas fa-chevron-right text-xs"></i>
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="border-t border-white/10 mt-12 py-8 relative overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-t from-amber-500/5 to-transparent"></div>
        <div class="max-w-7xl mx-auto px-4 text-center relative z-10">
            <p class="signature-font text-3xl gold-gradient-text mb-2">Journal By Lukmanshidiq</p>
            <p class="text-sm text-gray-500 mb-4">Professional Trading Journal & Analytics</p>
            <div class="flex justify-center gap-4 text-gray-600">
                <i class="fas fa-chart-line hover:text-amber-400 transition-colors cursor-pointer"></i>
                <i class="fas fa-coins hover:text-amber-400 transition-colors cursor-pointer"></i>
                <i class="fas fa-gem hover:text-amber-400 transition-colors cursor-pointer"></i>
            </div>
        </div>
    </footer>

    <!-- Add Trade Modal -->
    <div id="tradeModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4">
        <div class="glass-card rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto transform transition-all scale-95 opacity-0 border border-amber-500/20" id="modalContent">
            <div class="p-6 border-b border-white/10 flex justify-between items-center sticky top-0 glass-card z-10">
                <div class="flex items-center gap-3">
                    <div class="p-2 gold-gradient-bg rounded-lg">
                        <i class="fas fa-plus text-white"></i>
                    </div>
                    <div>
                        <h2 class="text-xl font-bold text-white">Add New Trade</h2>
                        <p class="text-xs text-gray-400">Journal By Lukmanshidiq</p>
                    </div>
                </div>
                <button onclick="closeModal()" class="w-10 h-10 rounded-xl bg-white/5 hover:bg-white/10 flex items-center justify-center transition-all hover:rotate-90">
                    <i class="fas fa-times text-gray-400"></i>
                </button>
            </div>
            
            <form id="tradeForm" class="p-6 space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Asset -->
                    <div class="space-y-2">
                        <label class="text-xs font-medium text-gray-400 uppercase tracking-wider">Asset/Pair <span class="text-red-400">*</span></label>
                        <div class="relative">
                            <input type="text" id="asset" name="asset" placeholder="EURUSD, AAPL, BTC..." class="w-full px-4 py-3 bg-slate-800/50 border border-white/10 rounded-xl focus:outline-none focus:border-amber-500/50 focus:bg-slate-800 transition-all text-white placeholder-gray-600">
                            <i class="fas fa-coins absolute right-3 top-3.5 text-gray-600"></i>
                        </div>
                    </div>
                    
                    <!-- Trade Type -->
                    <div class="space-y-2">
                        <label class="text-xs font-medium text-gray-400 uppercase tracking-wider">Position <span class="text-red-400">*</span></label>
                        <div class="grid grid-cols-2 gap-3">
                            <label class="cursor-pointer">
                                <input type="radio" name="type" value="LONG" class="peer hidden" checked>
                                <div class="px-4 py-3 rounded-xl border border-white/10 peer-checked:border-green-500/50 peer-checked:bg-green-500/10 text-center transition-all text-gray-400 peer-checked:text-green-400 hover:border-white/20">
                                    <i class="fas fa-arrow-up mr-2"></i>Long
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="type" value="SHORT" class="peer hidden">
                                <div class="px-4 py-3 rounded-xl border border-white/10 peer-checked:border-red-500/50 peer-checked:bg-red-500/10 text-center transition-all text-gray-400 peer-checked:text-red-400 hover:border-white/20">
                                    <i class="fas fa-arrow-down mr-2"></i>Short
                                </div>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Entry Price -->
                    <div class="space-y-2">
                        <label class="text-xs font-medium text-gray-400 uppercase tracking-wider">Entry Price <span class="text-red-400">*</span></label>
                        <div class="relative">
                            <span class="absolute left-3 top-3.5 text-gray-500">$</span>
                            <input type="number" id="entryPrice" name="entryPrice" step="0.00000001" min="0" class="w-full pl-8 pr-4 py-3 bg-slate-800/50 border border-white/10 rounded-xl focus:outline-none focus:border-amber-500/50 focus:bg-slate-800 transition-all text-white mono-font">
                        </div>
                    </div>
                    
                    <!-- Exit Price -->
                    <div class="space-y-2">
                        <label class="text-xs font-medium text-gray-400 uppercase tracking-wider">Exit Price <span class="text-gray-500 text-xs normal-case">(Optional)</span></label>
                        <div class="relative">
                            <span class="absolute left-3 top-3.5 text-gray-500">$</span>
                            <input type="number" id="exitPrice" name="exitPrice" step="0.00000001" min="0" class="w-full pl-8 pr-4 py-3 bg-slate-800/50 border border-white/10 rounded-xl focus:outline-none focus:border-amber-500/50 focus:bg-slate-800 transition-all text-white mono-font">
                        </div>
                    </div>
                    
                    <!-- Position Size -->
                    <div class="space-y-2">
                        <label class="text-xs font-medium text-gray-400 uppercase tracking-wider">Position Size <span class="text-red-400">*</span></label>
                        <div class="relative">
                            <input type="number" id="positionSize" name="positionSize" step="0.00000001" min="0" class="w-full px-4 py-3 bg-slate-800/50 border border-white/10 rounded-xl focus:outline-none focus:border-amber-500/50 focus:bg-slate-800 transition-all text-white mono-font">
                            <i class="fas fa-layer-group absolute right-3 top-3.5 text-gray-600"></i>
                        </div>
                    </div>
                    
                    <!-- Stop Loss -->
                    <div class="space-y-2">
                        <label class="text-xs font-medium text-gray-400 uppercase tracking-wider">Stop Loss <span class="text-gray-500 text-xs normal-case">(Optional)</span></label>
                        <div class="relative">
                            <span class="absolute left-3 top-3.5 text-gray-500">$</span>
                            <input type="number" id="stopLoss" name="stopLoss" step="0.00000001" min="0" class="w-full pl-8 pr-4 py-3 bg-slate-800/50 border border-white/10 rounded-xl focus:outline-none focus:border-red-500/50 focus:bg-slate-800 transition-all text-white mono-font">
                        </div>
                    </div>
                    
                    <!-- Take Profit -->
                    <div class="space-y-2">
                        <label class="text-xs font-medium text-gray-400 uppercase tracking-wider">Take Profit <span class="text-gray-500 text-xs normal-case">(Optional)</span></label>
                        <div class="relative">
                            <span class="absolute left-3 top-3.5 text-gray-500">$</span>
                            <input type="number" id="takeProfit" name="takeProfit" step="0.00000001" min="0" class="w-full pl-8 pr-4 py-3 bg-slate-800/50 border border-white/10 rounded-xl focus:outline-none focus:border-green-500/50 focus:bg-slate-800 transition-all text-white mono-font">
                        </div>
                    </div>
                    
                    <!-- Date -->
                    <div class="space-y-2">
                        <label class="text-xs font-medium text-gray-400 uppercase tracking-wider">Trade Date <span class="text-red-400">*</span></label>
                        <input type="datetime-local" id="tradeDate" name="tradeDate" class="w-full px-4 py-3 bg-slate-800/50 border border-white/10 rounded-xl focus:outline-none focus:border-amber-500/50 focus:bg-slate-800 transition-all text-white mono-font">
                    </div>
                </div>
                
                <!-- Strategy -->
                <div class="space-y-2">
                    <label class="text-xs font-medium text-gray-400 uppercase tracking-wider">Strategy</label>
                    <div class="relative">
                        <select id="strategy" name="strategy" class="w-full px-4 py-3 bg-slate-800/50 border border-white/10 rounded-xl focus:outline-none focus:border-amber-500/50 focus:bg-slate-800 transition-all text-white appearance-none cursor-pointer">
                            <option value="" class="bg-slate-800">Select Strategy...</option>
                            <option value="Breakout" class="bg-slate-800">Breakout</option>
                            <option value="Trend Following" class="bg-slate-800">Trend Following</option>
                            <option value="Reversal" class="bg-slate-800">Reversal</option>
                            <option value="Scalping" class="bg-slate-800">Scalping</option>
                            <option value="Swing Trading" class="bg-slate-800">Swing Trading</option>
                            <option value="Day Trading" class="bg-slate-800">Day Trading</option>
                            <option value="Position Trading" class="bg-slate-800">Position Trading</option>
                        </select>
                        <i class="fas fa-chevron-down absolute right-3 top-3.5 text-gray-600 pointer-events-none"></i>
                    </div>
                </div>
                
                <!-- Notes -->
                <div class="space-y-2">
                    <label class="text-xs font-medium text-gray-400 uppercase tracking-wider">Trade Notes</label>
                    <textarea id="notes" name="notes" rows="3" placeholder="Market conditions, emotional state, lessons learned..." class="w-full px-4 py-3 bg-slate-800/50 border border-white/10 rounded-xl focus:outline-none focus:border-amber-500/50 focus:bg-slate-800 transition-all text-white placeholder-gray-600 resize-none"></textarea>
                </div>
                
                <!-- Risk Preview -->
                <div class="bg-gradient-to-r from-amber-500/10 to-orange-500/10 rounded-xl p-4 border border-amber-500/20">
                    <h4 class="font-semibold text-amber-400 mb-3 flex items-center gap-2">
                        <i class="fas fa-calculator"></i>
                        Risk Preview
                    </h4>
                    <div class="grid grid-cols-3 gap-4 text-sm">
                        <div class="text-center p-3 bg-slate-800/50 rounded-lg border border-white/5">
                            <p class="text-gray-500 text-xs mb-1">Risk/Reward</p>
                            <p class="font-bold text-lg text-white mono-font" id="riskRewardRatio">-</p>
                        </div>
                        <div class="text-center p-3 bg-slate-800/50 rounded-lg border border-white/5">
                            <p class="text-gray-500 text-xs mb-1">Potential Loss</p>
                            <p class="font-bold text-lg text-red-400 mono-font" id="potentialLoss">-</p>
                        </div>
                        <div class="text-center p-3 bg-slate-800/50 rounded-lg border border-white/5">
                            <p class="text-gray-500 text-xs mb-1">Potential Profit</p>
                            <p class="font-bold text-lg text-green-400 mono-font" id="potentialProfit">-</p>
                        </div>
                    </div>
                </div>
                
                <div class="flex gap-4 pt-4">
                    <button type="button" onclick="closeModal()" class="flex-1 px-6 py-3 border border-white/10 rounded-xl hover:bg-white/5 transition-all font-medium text-gray-300">Cancel</button>
                    <button type="submit" id="saveButton" class="flex-1 px-6 py-3 gold-gradient-bg text-white rounded-xl font-semibold transition-all transform hover:scale-[1.02] neon-glow flex items-center justify-center gap-2">
                        <i class="fas fa-save"></i>
                        <span>Save Trade</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // State Management
        let trades = JSON.parse(localStorage.getItem('trades')) || [];
        let currentPage = 1;
        const itemsPerPage = 10;
        let sortColumn = 'date';
        let sortDirection = 'desc';

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderTrades();
            updateStats();
            setupEventListeners();
            
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('tradeDate').value = now.toISOString().slice(0, 16);
        });

        function toggleTheme() {
            showNotification('Premium dark mode active', 'info');
        }

        function openModal() {
            const modal = document.getElementById('tradeModal');
            const content = document.getElementById('modalContent');
            modal.classList.remove('hidden');
            setTimeout(() => {
                content.classList.remove('scale-95', 'opacity-0');
                content.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        function closeModal() {
            const modal = document.getElementById('tradeModal');
            const content = document.getElementById('modalContent');
            content.classList.remove('scale-100', 'opacity-100');
            content.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
                document.getElementById('tradeForm').reset();
                const now = new Date();
                now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
                document.getElementById('tradeDate').value = now.toISOString().slice(0, 16);
                document.getElementById('riskRewardRatio').textContent = '-';
                document.getElementById('potentialLoss').textContent = '-';
                document.getElementById('potentialProfit').textContent = '-';
                const saveBtn = document.getElementById('saveButton');
                saveBtn.disabled = false;
                saveBtn.innerHTML = '<i class="fas fa-save"></i><span>Save Trade</span>';
            }, 300);
        }

        document.getElementById('tradeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const saveBtn = document.getElementById('saveButton');
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Saving...</span>';
            
            try {
                const assetInput = document.getElementById('asset');
                const entryPriceInput = document.getElementById('entryPrice');
                const exitPriceInput = document.getElementById('exitPrice');
                const positionSizeInput = document.getElementById('positionSize');
                const stopLossInput = document.getElementById('stopLoss');
                const takeProfitInput = document.getElementById('takeProfit');
                const tradeDateInput = document.getElementById('tradeDate');
                const strategyInput = document.getElementById('strategy');
                const notesInput = document.getElementById('notes');
                
                if (!assetInput.value.trim()) throw new Error('Asset is required');
                if (!entryPriceInput.value || isNaN(parseFloat(entryPriceInput.value))) throw new Error('Valid entry price is required');
                if (!positionSizeInput.value || isNaN(parseFloat(positionSizeInput.value))) throw new Error('Valid position size is required');
                if (!tradeDateInput.value) throw new Error('Trade date is required');
                
                const trade = {
                    id: Date.now(),
                    asset: assetInput.value.trim().toUpperCase(),
                    type: document.querySelector('input[name="type"]:checked')?.value || 'LONG',
                    entryPrice: parseFloat(entryPriceInput.value),
                    exitPrice: exitPriceInput.value ? parseFloat(exitPriceInput.value) : null,
                    positionSize: parseFloat(positionSizeInput.value),
                    stopLoss: stopLossInput.value ? parseFloat(stopLossInput.value) : null,
                    takeProfit: takeProfitInput.value ? parseFloat(takeProfitInput.value) : null,
                    date: tradeDateInput.value,
                    strategy: strategyInput.value || '',
                    notes: notesInput.value || '',
                    status: exitPriceInput.value ? 'CLOSED' : 'OPEN',
                    createdAt: new Date().toISOString()
                };
                
                if (trade.exitPrice && !isNaN(trade.exitPrice)) {
                    const priceDiff = trade.type === 'LONG' ? 
                        trade.exitPrice - trade.entryPrice : 
                        trade.entryPrice - trade.exitPrice;
                    trade.pnl = priceDiff * trade.positionSize;
                } else {
                    trade.pnl = null;
                }
                
                trades.unshift(trade);
                localStorage.setItem('trades', JSON.stringify(trades));
                
                renderTrades();
                updateStats();
                showNotification('Trade saved successfully!', 'success');
                closeModal();
                
            } catch (error) {
                console.error('Save error:', error);
                showNotification('Error: ' + error.message, 'error');
                saveBtn.disabled = false;
                saveBtn.innerHTML = '<i class="fas fa-save"></i><span>Save Trade</span>';
            }
        });

        function calculateRiskReward() {
            const entry = parseFloat(document.getElementById('entryPrice').value);
            const sl = parseFloat(document.getElementById('stopLoss').value);
            const tp = parseFloat(document.getElementById('takeProfit').value);
            const size = parseFloat(document.getElementById('positionSize').value) || 0;
            
            const rrElement = document.getElementById('riskRewardRatio');
            const lossElement = document.getElementById('potentialLoss');
            const profitElement = document.getElementById('potentialProfit');
            
            if (entry && sl && tp && entry > 0 && sl > 0 && tp > 0) {
                const risk = Math.abs(entry - sl);
                const reward = Math.abs(tp - entry);
                
                if (risk > 0) {
                    const ratio = (reward / risk).toFixed(2);
                    rrElement.textContent = `1:${ratio}`;
                    
                    if (size > 0) {
                        const loss = (risk * size).toFixed(2);
                        const profit = (reward * size).toFixed(2);
                        lossElement.textContent = `-$${loss}`;
                        profitElement.textContent = `+$${profit}`;
                    } else {
                        lossElement.textContent = '-';
                        profitElement.textContent = '-';
                    }
                } else {
                    rrElement.textContent = '-';
                    lossElement.textContent = '-';
                    profitElement.textContent = '-';
                }
            } else {
                rrElement.textContent = '-';
                lossElement.textContent = '-';
                profitElement.textContent = '-';
            }
        }

        ['entryPrice', 'stopLoss', 'takeProfit', 'positionSize'].forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('input', calculateRiskReward);
            }
        });

        function sortTable(column) {
            if (sortColumn === column) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = column;
                sortDirection = 'desc';
            }
            renderTrades();
        }

        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                currentPage = 1;
                renderTrades();
            });
        }

        function changePage(direction) {
            const filteredTrades = getFilteredTrades();
            const maxPage = Math.ceil(filteredTrades.length / itemsPerPage) || 1;
            
            currentPage += direction;
            if (currentPage < 1) currentPage = 1;
            if (currentPage > maxPage) currentPage = maxPage;
            
            renderTrades();
        }

        function getFilteredTrades() {
            const searchTerm = (document.getElementById('searchInput')?.value || '').toLowerCase();
            let filtered = trades.filter(trade => {
                const assetMatch = (trade.asset || '').toLowerCase().includes(searchTerm);
                const typeMatch = (trade.type || '').toLowerCase().includes(searchTerm);
                const strategyMatch = (trade.strategy || '').toLowerCase().includes(searchTerm);
                return assetMatch || typeMatch || strategyMatch;
            });
            
            filtered.sort((a, b) => {
                let valA, valB;
                if (sortColumn === 'date') {
                    valA = new Date(a.date || 0);
                    valB = new Date(b.date || 0);
                } else if (sortColumn === 'asset') {
                    valA = (a.asset || '').toLowerCase();
                    valB = (b.asset || '').toLowerCase();
                } else if (sortColumn === 'pnl') {
                    valA = parseFloat(a.pnl) || 0;
                    valB = parseFloat(b.pnl) || 0;
                }
                
                if (sortDirection === 'asc') return valA > valB ? 1 : -1;
                return valA < valB ? 1 : -1;
            });
            
            return filtered;
        }

        function renderTrades() {
            const tbody = document.getElementById('tradesTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const filteredTrades = getFilteredTrades();
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageTrades = filteredTrades.slice(start, end);
            
            if (pageTrades.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" class="px-6 py-12 text-center">
                            <div class="flex flex-col items-center gap-4">
                                <div class="w-16 h-16 rounded-full bg-amber-500/10 flex items-center justify-center">
                                    <i class="fas fa-inbox text-2xl text-amber-500/50"></i>
                                </div>
                                <p class="text-gray-500">No trades found. Add your first trade!</p>
                                <button onclick="openModal()" class="px-4 py-2 gold-gradient-bg text-white rounded-lg text-sm font-medium">Add Trade</button>
                            </div>
                        </td>
                    </tr>
                `;
            } else {
                pageTrades.forEach(trade => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-white/5 transition-colors group';
                    
                    const pnlValue = parseFloat(trade.pnl);
                    const pnlClass = pnlValue > 0 ? 'text-green-400 profit-glow' : pnlValue < 0 ? 'text-red-400 loss-glow' : 'text-gray-400';
                    const pnlSign = pnlValue > 0 ? '+' : '';
                    const pnlDisplay = trade.pnl !== null && !isNaN(pnlValue) ? 
                        pnlSign + '$' + pnlValue.toFixed(2) : '-';
                    
                    const statusColor = trade.status === 'OPEN' ? 
                        'bg-yellow-500/20 text-yellow-400 border-yellow-500/30' : 
                        'bg-green-500/20 text-green-400 border-green-500/30';
                    
                    const typeIcon = trade.type === 'LONG' ? 'fa-arrow-trend-up' : 'fa-arrow-trend-down';
                    const typeColor = trade.type === 'LONG' ? 'text-green-400' : 'text-red-400';
                    
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400 mono-font">${new Date(trade.date).toLocaleDateString('id-ID')}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center gap-2">
                                <span class="font-bold text-white">${trade.asset}</span>
                                ${trade.strategy ? `<span class="text-xs px-2 py-0.5 rounded bg-white/5 text-gray-400 border border-white/10">${trade.strategy}</span>` : ''}
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="${typeColor} font-medium text-sm flex items-center gap-1">
                                <i class="fas ${typeIcon} text-xs"></i>
                                ${trade.type}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-300 mono-font">${parseFloat(trade.entryPrice).toFixed(5)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-300 mono-font">${trade.exitPrice ? parseFloat(trade.exitPrice).toFixed(5) : '-'}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-300 mono-font">${trade.positionSize}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-right font-bold mono-font ${pnlClass}">${pnlDisplay}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">
                            <span class="px-3 py-1 rounded-full text-xs font-medium border ${statusColor} status-badge">
                                ${trade.status}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">
                            <div class="flex items-center justify-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                <button onclick="viewTrade(${trade.id})" class="w-8 h-8 rounded-lg bg-blue-500/10 hover:bg-blue-500/20 text-blue-400 flex items-center justify-center transition-all" title="View">
                                    <i class="fas fa-eye text-sm"></i>
                                </button>
                                <button onclick="deleteTrade(${trade.id})" class="w-8 h-8 rounded-lg bg-red-500/10 hover:bg-red-500/20 text-red-400 flex items-center justify-center transition-all" title="Delete">
                                    <i class="fas fa-trash text-sm"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }
            
            const showingCount = document.getElementById('showingCount');
            const currentPageEl = document.getElementById('currentPage');
            if (showingCount) showingCount.textContent = filteredTrades.length;
            if (currentPageEl) currentPageEl.textContent = currentPage;
        }

        function viewTrade(id) {
            const trade = trades.find(t => t.id === id);
            if (!trade) return;
            
            const pnlText = trade.pnl !== null ? 
                (parseFloat(trade.pnl) >= 0 ? '+' : '') + '$' + parseFloat(trade.pnl).toFixed(2) : 
                'Open';
            
            alert(`

     TRADE DETAILS - ${trade.asset.padEnd(10)}

  Date: ${new Date(trade.date).toLocaleString('id-ID')}
  Type: ${trade.type} | Status: ${trade.status}
  
   PRICES
  Entry:  $${parseFloat(trade.entryPrice).toFixed(5)}
  Exit:   ${trade.exitPrice ? '$' + parseFloat(trade.exitPrice).toFixed(5) : 'N/A'}
  Size:   ${trade.positionSize}
  
    RISK MANAGEMENT
  Stop Loss:   ${trade.stopLoss ? '$' + parseFloat(trade.stopLoss).toFixed(5) : 'N/A'}
  Take Profit: ${trade.takeProfit ? '$' + parseFloat(trade.takeProfit).toFixed(5) : 'N/A'}
  
   RESULT
  P&L: ${pnlText}
  Strategy: ${trade.strategy || 'N/A'}
  
   Notes:
  ${trade.notes || 'No notes recorded'}
            `);
        }

        function updateStats() {
            const closedTrades = trades.filter(t => t.status === 'CLOSED' && t.pnl !== null);
            const totalPnL = closedTrades.reduce((sum, t) => sum + (parseFloat(t.pnl) || 0), 0);
            const wins = closedTrades.filter(t => parseFloat(t.pnl) > 0).length;
            const losses = closedTrades.filter(t => parseFloat(t.pnl) < 0).length;
            const winRate = closedTrades.length > 0 ? ((wins / closedTrades.length) * 100).toFixed(1) : 0;
            const bestTrade = closedTrades.length > 0 ? 
                Math.max(...closedTrades.map(t => parseFloat(t.pnl) || 0)) : 0;
            const activeTrades = trades.filter(t => t.status === 'OPEN').length;
            
            let winStreak = 0, lossStreak = 0, currentWinStreak = 0, currentLossStreak = 0;
            const sortedTrades = [...closedTrades].sort((a, b) => new Date(a.date) - new Date(b.date));
            
            sortedTrades.forEach(trade => {
                if (parseFloat(trade.pnl) > 0) {
                    currentWinStreak++;
                    currentLossStreak = 0;
                    winStreak = Math.max(winStreak, currentWinStreak);
                } else {
                    currentLossStreak++;
                    currentWinStreak = 0;
                    lossStreak = Math.max(lossStreak, currentLossStreak);
                }
            });
            
            const winTrades = closedTrades.filter(t => parseFloat(t.pnl) > 0);
            const lossTrades = closedTrades.filter(t => parseFloat(t.pnl) < 0);
            const avgWin = winTrades.length > 0 ? 
                winTrades.reduce((sum, t) => sum + parseFloat(t.pnl), 0) / winTrades.length : 0;
            const avgLoss = lossTrades.length > 0 ? 
                lossTrades.reduce((sum, t) => sum + parseFloat(t.pnl), 0) / lossTrades.length : 0;
            
            const setText = (id, text) => {
                const el = document.getElementById(id);
                if (el) el.textContent = text;
            };
            
            setText('totalPnL', (totalPnL >= 0 ? '+' : '') + '$' + totalPnL.toFixed(2));
            const totalPnLEl = document.getElementById('totalPnL');
            if (totalPnLEl) {
                totalPnLEl.className = `text-4xl font-bold mono-font tracking-tight ${totalPnL >= 0 ? 'text-green-400 profit-glow' : 'text-red-400 loss-glow'}`;
            }
            
            setText('winRate', winRate + '%');
            setText('totalWins', wins);
            setText('totalLosses', losses);
            setText('bestTrade', '$' + bestTrade.toFixed(2));
            setText('activeTrades', activeTrades);
            setText('totalTrades', trades.length);
            setText('winningStreak', winStreak);
            setText('losingStreak', lossStreak);
            setText('avgWin', '$' + avgWin.toFixed(0));
            setText('avgLoss', '$' + avgLoss.toFixed(0));
        }

        function deleteTrade(id) {
            if (confirm('Are you sure you want to delete this trade?')) {
                trades = trades.filter(t => t.id !== id);
                localStorage.setItem('trades', JSON.stringify(trades));
                renderTrades();
                updateStats();
                showNotification('Trade deleted successfully', 'info');
            }
        }

        // EXPORT TO EXCEL - PREMIUM VERSION
        function exportToExcel() {
            try {
                if (trades.length === 0) {
                    showNotification('No data to export', 'error');
                    return;
                }

                // Calculate statistics
                const closedTrades = trades.filter(t => t.status === 'CLOSED' && t.pnl !== null);
                const totalPnL = closedTrades.reduce((sum, t) => sum + (parseFloat(t.pnl) || 0), 0);
                const wins = closedTrades.filter(t => parseFloat(t.pnl) > 0).length;
                const losses = closedTrades.filter(t => parseFloat(t.pnl) < 0).length;
                const winRate = closedTrades.length > 0 ? ((wins / closedTrades.length) * 100).toFixed(1) : 0;
                const bestTrade = closedTrades.length > 0 ? Math.max(...closedTrades.map(t => parseFloat(t.pnl) || 0)) : 0;
                const worstTrade = closedTrades.length > 0 ? Math.min(...closedTrades.map(t => parseFloat(t.pnl) || 0)) : 0;
                
                const winTrades = closedTrades.filter(t => parseFloat(t.pnl) > 0);
                const lossTrades = closedTrades.filter(t => parseFloat(t.pnl) < 0);
                const avgWin = winTrades.length > 0 ? winTrades.reduce((sum, t) => sum + parseFloat(t.pnl), 0) / winTrades.length : 0;
                const avgLoss = lossTrades.length > 0 ? lossTrades.reduce((sum, t) => sum + parseFloat(t.pnl), 0) / lossTrades.length : 0;

                // Create workbook
                const wb = XLSX.utils.book_new();
                
                // ==================== STYLES ====================
                const styles = {
                    title: { font: { name: 'Playfair Display', sz: 24, bold: true, color: { rgb: 'F59E0B' } }, alignment: { horizontal: 'center' } },
                    subtitle: { font: { name: 'Inter', sz: 10, color: { rgb: '6B7280' } }, alignment: { horizontal: 'center' } },
                    header: { 
                        font: { name: 'Inter', sz: 11, bold: true, color: { rgb: 'FFFFFF' } }, 
                        fill: { fgColor: { rgb: 'D97706' }, patternType: 'solid' },
                        alignment: { horizontal: 'center', vertical: 'center' },
                        border: { bottom: { style: 'medium', color: { rgb: 'B45309' } } }
                    },
                    subheader: {
                        font: { name: 'Inter', sz: 12, bold: true, color: { rgb: '1F2937' } },
                        fill: { fgColor: { rgb: 'FDE68A' }, patternType: 'solid' },
                        alignment: { horizontal: 'left', vertical: 'center' }
                    },
                    data: { font: { name: 'JetBrains Mono', sz: 10 }, alignment: { vertical: 'center' } },
                    number: { font: { name: 'JetBrains Mono', sz: 10 }, alignment: { horizontal: 'right' } },
                    currency: { font: { name: 'JetBrains Mono', sz: 10 }, numFmt: '"$"#,##0.00', alignment: { horizontal: 'right' } },
                    currency5: { font: { name: 'JetBrains Mono', sz: 10 }, numFmt: '"$"#,##0.00000', alignment: { horizontal: 'right' } },
                    date: { font: { name: 'Inter', sz: 10 }, numFmt: 'yyyy-mm-dd hh:mm', alignment: { horizontal: 'center' } },
                    statusOpen: { 
                        font: { name: 'Inter', sz: 9, bold: true, color: { rgb: '92400E' } },
                        fill: { fgColor: { rgb: 'FEF3C7' }, patternType: 'solid' },
                        alignment: { horizontal: 'center' }
                    },
                    statusClosed: { 
                        font: { name: 'Inter', sz: 9, bold: true, color: { rgb: '065F46' } },
                        fill: { fgColor: { rgb: 'D1FAE5' }, patternType: 'solid' },
                        alignment: { horizontal: 'center' }
                    },
                    typeLong: { font: { name: 'Inter', sz: 10, bold: true, color: { rgb: '059669' } }, alignment: { horizontal: 'center' } },
                    typeShort: { font: { name: 'Inter', sz: 10, bold: true, color: { rgb: 'DC2626' } }, alignment: { horizontal: 'center' } },
                    profit: { font: { name: 'JetBrains Mono', sz: 10, bold: true, color: { rgb: '059669' } }, numFmt: '"$"#,##0.00', alignment: { horizontal: 'right' } },
                    loss: { font: { name: 'JetBrains Mono', sz: 10, bold: true, color: { rgb: 'DC2626' } }, numFmt: '"$"#,##0.00', alignment: { horizontal: 'right' } },
                    neutral: { font: { name: 'JetBrains Mono', sz: 10, color: { rgb: '6B7280' } }, alignment: { horizontal: 'right' } },
                    statLabel: { font: { name: 'Inter', sz: 10, color: { rgb: '6B7280' } }, alignment: { horizontal: 'left' } },
                    statValue: { font: { name: 'JetBrains Mono', sz: 11, bold: true }, alignment: { horizontal: 'right' } },
                    statPositive: { font: { name: 'JetBrains Mono', sz: 11, bold: true, color: { rgb: '059669' } }, alignment: { horizontal: 'right' } },
                    statNegative: { font: { name: 'JetBrains Mono', sz: 11, bold: true, color: { rgb: 'DC2626' } }, alignment: { horizontal: 'right' } },
                    footer: { font: { name: 'Inter', sz: 9, italic: true, color: { rgb: '9CA3AF' } }, alignment: { horizontal: 'center' } }
                };

                // ==================== SHEET 1: DASHBOARD ====================
                const dashboardData = [
                    ['', '', '', '', '', ''],
                    ['JOURNAL BY LUKMANSHIDIQ', '', '', '', '', ''],
                    ['Professional Trading Journal & Analytics', '', '', '', '', ''],
                    ['', '', '', '', '', ''],
                    ['PERFORMANCE SUMMARY', '', '', '', '', ''],
                    ['', '', '', '', '', ''],
                    ['Metric', 'Value', '', 'Metric', 'Value', ''],
                    ['Total P&L', totalPnL, '', 'Win Rate', winRate + '%', ''],
                    ['Total Trades', trades.length, '', 'Active Trades', trades.filter(t => t.status === 'OPEN').length, ''],
                    ['Winning Trades', wins, '', 'Losing Trades', losses, ''],
                    ['Best Trade', bestTrade, '', 'Worst Trade', worstTrade, ''],
                    ['Average Win', avgWin, '', 'Average Loss', avgLoss, ''],
                    ['', '', '', '', '', ''],
                    ['Generated:', new Date().toLocaleString('id-ID'), '', '', '', ''],
                    ['', '', '', '', '', '']
                ];

                const wsDashboard = XLSX.utils.aoa_to_sheet(dashboardData);
                
                // Merge cells for title
                wsDashboard['!merges'] = [
                    { s: { r: 1, c: 0 }, e: { r: 1, c: 5 } },
                    { s: { r: 2, c: 0 }, e: { r: 2, c: 5 } },
                    { s: { r: 4, c: 0 }, e: { r: 4, c: 5 } }
                ];

                // Apply styles to dashboard
                wsDashboard['A2'].s = styles.title;
                wsDashboard['A3'].s = styles.subtitle;
                wsDashboard['A5'].s = {
                    font: { name: 'Inter', sz: 12, bold: true, color: { rgb: '92400E' } },
                    fill: { fgColor: { rgb: 'FEF3C7' }, patternType: 'solid' },
                    alignment: { horizontal: 'center', vertical: 'center' },
                    border: { 
                        top: { style: 'medium', color: { rgb: 'F59E0B' } },
                        bottom: { style: 'medium', color: { rgb: 'F59E0B' } }
                    }
                };
                
                // Style data rows
                for (let i = 7; i <= 11; i++) {
                    wsDashboard['A' + i].s = styles.statLabel;
                    wsDashboard['B' + i].s = i === 7 ? (totalPnL >= 0 ? styles.statPositive : styles.statNegative) : styles.statValue;
                    wsDashboard['D' + i].s = styles.statLabel;
                    wsDashboard['E' + i].s = styles.statValue;
                }

                // Column widths
                wsDashboard['!cols'] = [
                    { wch: 18 }, { wch: 15 }, { wch: 3 }, { wch: 18 }, { wch: 15 }, { wch: 3 }
                ];

                XLSX.utils.book_append_sheet(wb, wsDashboard, "Dashboard");

                // ==================== SHEET 2: TRADE LOG ====================
                const tradeHeaders = [
                    'No', 'Date', 'Asset', 'Type', 'Status', 'Entry Price', 'Exit Price', 
                    'Position Size', 'Stop Loss', 'Take Profit', 'P&L ($)', 'Strategy', 'Notes'
                ];

                const tradeData = trades.map((trade, index) => [
                    index + 1,
                    trade.date,
                    trade.asset,
                    trade.type,
                    trade.status,
                    trade.entryPrice,
                    trade.exitPrice || '',
                    trade.positionSize,
                    trade.stopLoss || '',
                    trade.takeProfit || '',
                    trade.pnl !== null ? parseFloat(trade.pnl) : '',
                    trade.strategy || '',
                    trade.notes || ''
                ]);

                const wsTrades = XLSX.utils.aoa_to_sheet([tradeHeaders, ...tradeData]);

                // Apply header styles
                const headerCols = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M'];
                headerCols.forEach(col => {
                    wsTrades[col + '1'].s = styles.header;
                });

                // Apply data styles
                for (let row = 2; row <= tradeData.length + 1; row++) {
                    const trade = trades[row - 2];
                    
                    // Number column
                    wsTrades['A' + row].s = { ...styles.data, alignment: { horizontal: 'center' } };
                    
                    // Date
                    wsTrades['B' + row].s = styles.date;
                    
                    // Asset
                    wsTrades['C' + row].s = { ...styles.data, font: { ...styles.data.font, bold: true } };
                    
                    // Type (Long/Short)
                    wsTrades['D' + row].s = trade.type === 'LONG' ? styles.typeLong : styles.typeShort;
                    
                    // Status
                    wsTrades['E' + row].s = trade.status === 'OPEN' ? styles.statusOpen : styles.statusClosed;
                    
                    // Prices (5 decimal)
                    wsTrades['F' + row].s = styles.currency5;
                    wsTrades['G' + row].s = trade.exitPrice ? styles.currency5 : styles.neutral;
                    wsTrades['I' + row].s = trade.stopLoss ? styles.currency5 : styles.neutral;
                    wsTrades['J' + row].s = trade.takeProfit ? styles.currency5 : styles.neutral;
                    
                    // Position Size
                    wsTrades['H' + row].s = styles.number;
                    
                    // P&L with color
                    if (trade.pnl !== null) {
                        const pnl = parseFloat(trade.pnl);
                        wsTrades['K' + row].s = pnl > 0 ? styles.profit : pnl < 0 ? styles.loss : styles.neutral;
                    } else {
                        wsTrades['K' + row].s = styles.neutral;
                    }
                    
                    // Strategy & Notes
                    wsTrades['L' + row].s = styles.data;
                    wsTrades['M' + row].s = styles.data;
                }

                // Column widths
                wsTrades['!cols'] = [
                    { wch: 5 },   // No
                    { wch: 18 },  // Date
                    { wch: 12 },  // Asset
                    { wch: 10 },  // Type
                    { wch: 10 },  // Status
                    { wch: 14 },  // Entry
                    { wch: 14 },  // Exit
                    { wch: 12 },  // Size
                    { wch: 14 },  // SL
                    { wch: 14 },  // TP
                    { wch: 14 },  // P&L
                    { wch: 18 },  // Strategy
                    { wch: 40 }   // Notes
                ];

                // Freeze header row
                wsTrades['!freeze'] = { xSplit: 0, ySplit: 1 };

                XLSX.utils.book_append_sheet(wb, wsTrades, "Trade Log");

                // ==================== SHEET 3: ANALYTICS ====================
                const monthlyStats = {};
                trades.forEach(trade => {
                    if (trade.status === 'CLOSED' && trade.pnl !== null) {
                        const date = new Date(trade.date);
                        const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                        if (!monthlyStats[key]) {
                            monthlyStats[key] = { trades: 0, wins: 0, losses: 0, pnl: 0 };
                        }
                        monthlyStats[key].trades++;
                        monthlyStats[key].pnl += parseFloat(trade.pnl);
                        if (parseFloat(trade.pnl) > 0) monthlyStats[key].wins++;
                        else monthlyStats[key].losses++;
                    }
                });

                const analyticsHeaders = ['Month', 'Total Trades', 'Wins', 'Losses', 'Win Rate (%)', 'Net P&L ($)'];
                const analyticsData = Object.entries(monthlyStats)
                    .sort((a, b) => a[0].localeCompare(b[0]))
                    .map(([month, stats]) => [
                        month,
                        stats.trades,
                        stats.wins,
                        stats.losses,
                        ((stats.wins / stats.trades) * 100).toFixed(1),
                        stats.pnl
                    ]);

                const wsAnalytics = XLSX.utils.aoa_to_sheet([analyticsHeaders, ...analyticsData]);

                // Style analytics
                analyticsHeaders.forEach((_, idx) => {
                    const col = String.fromCharCode(65 + idx);
                    wsAnalytics[col + '1'].s = styles.header;
                });

                for (let row = 2; row <= analyticsData.length + 1; row++) {
                    wsAnalytics['A' + row].s = { ...styles.data, alignment: { horizontal: 'center' } };
                    wsAnalytics['B' + row].s = styles.number;
                    wsAnalytics['C' + row].s = { ...styles.number, font: { ...styles.number.font, color: { rgb: '059669' } } };
                    wsAnalytics['D' + row].s = { ...styles.number, font: { ...styles.number.font, color: { rgb: 'DC2626' } } };
                    wsAnalytics['E' + row].s = styles.number;
                    
                    const pnl = analyticsData[row - 2][5];
                    wsAnalytics['F' + row].s = pnl >= 0 ? styles.profit : styles.loss;
                }

                wsAnalytics['!cols'] = [
                    { wch: 12 }, { wch: 12 }, { wch: 10 }, { wch: 10 }, { wch: 12 }, { wch: 15 }
                ];

                XLSX.utils.book_append_sheet(wb, wsAnalytics, "Analytics");

                // ==================== SAVE FILE ====================
                const dateStr = new Date().toISOString().split('T')[0];
                const filename = `Trading-Journal-Lukmanshidiq-${dateStr}.xlsx`;
                
                XLSX.writeFile(wb, filename);
                showNotification('Premium Excel report downloaded!', 'success');
                
            } catch (error) {
                console.error('Export error:', error);
                showNotification('Failed to export: ' + error.message, 'error');
            }
        }

        function showNotification(message, type) {
            document.querySelectorAll('.notification-toast').forEach(n => n.remove());
            
            const notification = document.createElement('div');
            notification.className = `notification-toast fixed bottom-4 right-4 px-6 py-4 rounded-xl shadow-2xl transform transition-all duration-300 translate-y-20 opacity-0 z-50 border ${
                type === 'success' ? 'bg-slate-800 border-green-500/50 text-green-400' : 
                type === 'error' ? 'bg-slate-800 border-red-500/50 text-red-400' : 
                'bg-slate-800 border-amber-500/50 text-amber-400'
            } font-medium flex items-center gap-3`;
            notification.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'} text-lg"></i>
                <span>${message}</span>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('translate-y-20', 'opacity-0');
            }, 10);
            
            setTimeout(() => {
                notification.classList.add('translate-y-20', 'opacity-0');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function setupEventListeners() {
            const modal = document.getElementById('tradeModal');
            if (modal) {
                modal.addEventListener('click', (e) => {
                    if (e.target.id === 'tradeModal') closeModal();
                });
            }
            
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') closeModal();
                if (e.ctrlKey && e.key === 'n') {
                    e.preventDefault();
                    openModal();
                }
            });
        }

        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });
    </script>
</body>
</html>
